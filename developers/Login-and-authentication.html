<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login &amp; Authentication &mdash; OpenTera 1.2.5 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=36f53d34"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Services Access Roles" href="../services/Services-Access.html" />
    <link rel="prev" title="Inter-service communication" href="Internal-services-communication-module.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            OpenTera
              <img src="../_static/LogoOpenTera200px.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.2.5
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Home.html">About OpenTera</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Architecture-Overview.html">OpenTera Architecture Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Security.html">Security</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Deployment.html">Deployment Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment/DeployWithDockerCompose.html">Deploying with Docker on Linux Servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment/DeployWithLinuxNative.html">Deploying OpenTera on a Linux Server</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Services and Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../services/OpenTera_Services.html">OpenTera Services Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/services.html">Core Services</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developers</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Developers.html">Developers setup guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Code-Structure.html">Code structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="Service-Creation.html">Creating a new service</a></li>
<li class="toctree-l1"><a class="reference internal" href="Database-Structure.html">Database Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="Form-Structure.html">Internal Form Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="Messages-structure.html">Internal messages structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="Internal-services-communication-module.html">Inter-service communication</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Login &amp; Authentication</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#authentication">Authentication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#user-api">User API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#http-basic-auth">HTTP Basic Auth</a></li>
<li class="toctree-l4"><a class="reference internal" href="#token-bearer">Token Bearer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#participant-api">Participant API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">HTTP Basic Auth</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">Token Bearer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#device-api">Device API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">Token Bearer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#token-request-argument">Token request argument</a></li>
<li class="toctree-l4"><a class="reference internal" href="#certificates">Certificates</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#service-api">Service API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id4">Token Bearer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">Token request argument</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#login">Login</a></li>
<li class="toctree-l2"><a class="reference internal" href="#logout">Logout</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../services/Services-Access.html">Services Access Roles</a></li>
<li class="toctree-l1"><a class="reference internal" href="Running-tests.html">Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="Translations.html">Translations</a></li>
<li class="toctree-l1"><a class="reference internal" href="Websockets-communication.html">Websockets communication</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OpenTera</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Login &amp; Authentication</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/developers/Login-and-authentication.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="login-authentication">
<h1>Login &amp; Authentication<a class="headerlink" href="#login-authentication" title="Link to this heading"></a></h1>
<p>In OpenTera, login and authentication are 2 separate concepts.</p>
<ul class="simple">
<li><p><strong>Authentication</strong> refers to the process of having sufficient credentials to access the</p></li>
<li><p><a class="reference internal" href="../services/teraserver/api/API.html"><span class="doc std std-doc">REST API</span></a>. Multiple authentication schemes are supported (see below)</p></li>
<li><p><strong>Login</strong> refers to the process of calling the appropriate login API, gets the current token for the authentication
and, optionally, opens a <a class="reference internal" href="Websockets-communication.html"><span class="doc std std-doc">websocket connection</span></a> to receive
<a class="reference internal" href="Messages-structure.html"><span class="doc std std-doc">messages and events</span></a>.</p></li>
</ul>
<hr class="docutils" />
<section id="authentication">
<h2>Authentication<a class="headerlink" href="#authentication" title="Link to this heading"></a></h2>
<p>Supported authentication depends on the <a class="reference internal" href="../services/teraserver/api/API.html"><span class="doc std std-doc">API level</span></a> that is accessed.</p>
<section id="user-api">
<h3>User API<a class="headerlink" href="#user-api" title="Link to this heading"></a></h3>
<section id="http-basic-auth">
<h4>HTTP Basic Auth<a class="headerlink" href="#http-basic-auth" title="Link to this heading"></a></h4>
<p>Using username and password authentication, the requester can be identified and allowed (or not)
to access that API. Since basic auth is implemented, it is quite important to always use SSL to encrypt communications
for security purpose when <a class="reference internal" href="../Deployment.html"><span class="doc std std-doc">deploying to a server</span></a>. Otherwise, login credentials may be at risk since they
would be sent over an unencrypted connection.</p>
</section>
<section id="token-bearer">
<h4>Token Bearer<a class="headerlink" href="#token-bearer" title="Link to this heading"></a></h4>
<p>Using the HTTP <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> header in a request, it is possible to use a token for authentication
<strong>after</strong> having obtained a valid token.</p>
<ul class="simple">
<li><p>In the <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> request header of the HTTP request, the <code class="docutils literal notranslate"><span class="pre">&lt;type&gt;</span></code> value must be set to <code class="docutils literal notranslate"><span class="pre">OpenTera</span></code> and the
<code class="docutils literal notranslate"><span class="pre">&lt;credentials&gt;</span></code> must contain a valid token.</p></li>
<li><p>User token can be obtained with a call to the <code class="docutils literal notranslate"><span class="pre">login</span></code> API (see below). <strong>Currently, users can’t log only using a
token</strong>. To get the initial token, an HTTP Basic Auth scheme must be used (see above).</p></li>
<li><p>User tokens are set to expire after 1 hour, and a new token can be obtained before expiration by calling the
<code class="docutils literal notranslate"><span class="pre">refreshtoken</span></code> <a class="reference internal" href="../services/teraserver/api/API.html"><span class="doc std std-doc">API</span></a>.</p></li>
</ul>
</section>
</section>
<section id="participant-api">
<h3>Participant API<a class="headerlink" href="#participant-api" title="Link to this heading"></a></h3>
<section id="id1">
<h4>HTTP Basic Auth<a class="headerlink" href="#id1" title="Link to this heading"></a></h4>
<p>Using username and password authentication, the requester can be identified and allowed (or not)
to access that API. Since basic auth is implemented, it is quite important to always use SSL to encrypt communications
for security purpose when <a class="reference internal" href="../Deployment.html"><span class="doc std std-doc">deploying to a server</span></a>.</p>
<ul class="simple">
<li><p><strong>For participants, that authentication scheme is optional</strong>. If no username and password are defined or if the
<code class="docutils literal notranslate"><span class="pre">participant_login_enabled</span></code> is set to <code class="docutils literal notranslate"><span class="pre">false</span></code> for a specific participant (see <a class="reference internal" href="Database-Structure.html"><span class="doc std std-doc">database objects</span></a>,
this scheme will not work.</p></li>
</ul>
</section>
<section id="id2">
<h4>Token Bearer<a class="headerlink" href="#id2" title="Link to this heading"></a></h4>
<p>Using the HTTP <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> header in a request, it is possible to use a token for authentication
instead of the standard username-password authentication. Each participant can also have a static access token.</p>
<ul class="simple">
<li><p>In the <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> request header of the HTTP request, the <code class="docutils literal notranslate"><span class="pre">&lt;type&gt;</span></code> value must be set to <code class="docutils literal notranslate"><span class="pre">OpenTera</span></code> and the
<code class="docutils literal notranslate"><span class="pre">&lt;credentials&gt;</span></code> must contain a valid token.</p></li>
<li><p>A permanent login token can be used to obtain a valid dynamic token for further queries. This allows a participant
to login without having a username-password scheme with some restrictions (see below). The static (permanent) token
for a participant is automatically generated if <code class="docutils literal notranslate"><span class="pre">participant_token_enabled</span></code> is set in the <code class="docutils literal notranslate"><span class="pre">TeraParticipant</span></code>
<a class="reference internal" href="Database-Structure.html"><span class="doc std std-doc">database object</span></a> model for that participant.</p>
<ul>
<li><p>If the initial <code class="docutils literal notranslate"><span class="pre">login</span></code> API call is done with the static token of a participant instead of a standard
username-password scheme, the available API calls are quite limited (or will return less information).</p></li>
<li><p>In the case where the initial <code class="docutils literal notranslate"><span class="pre">login</span></code> scheme is done with the participant static token, a dynamic token is not
generated and thus can’t be used for further calls.</p></li>
<li><p>In the API functions, the <code class="docutils literal notranslate"><span class="pre">role</span></code> parameter is used to check the access level. If the required role is set to
<code class="docutils literal notranslate"><span class="pre">full</span></code>, a dynamic token will be required and the static token will not work. If the required role is set to
<code class="docutils literal notranslate"><span class="pre">limited</span></code>, the static token will work to access that API function. For example,
<code class="docutils literal notranslate"><span class="pre">&#64;participant_multi_auth.login_required(role='limited')</span></code> will allow the decorated function to be called with a
static token.</p></li>
</ul>
</li>
<li><p>Participants dynamic token can be obtained with a call to the <code class="docutils literal notranslate"><span class="pre">login</span></code> API (see below) with a username-password
scheme.</p></li>
<li><p>Participants tokens are set to expire after 1 hour, and a new token can be obtained before expiration by calling the
<code class="docutils literal notranslate"><span class="pre">refreshtoken</span></code> <a class="reference internal" href="../services/teraserver/api/API.html"><span class="doc std std-doc">API</span></a>.</p></li>
</ul>
</section>
</section>
<section id="device-api">
<h3>Device API<a class="headerlink" href="#device-api" title="Link to this heading"></a></h3>
<section id="id3">
<h4>Token Bearer<a class="headerlink" href="#id3" title="Link to this heading"></a></h4>
<p>Using the HTTP <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> header in a request, it is possible to use a token for authentication
for devices.</p>
<ul class="simple">
<li><p>In the <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> request header of the HTTP request, the <code class="docutils literal notranslate"><span class="pre">&lt;type&gt;</span></code> value must be set to <code class="docutils literal notranslate"><span class="pre">OpenTera</span></code> and the
<code class="docutils literal notranslate"><span class="pre">&lt;credentials&gt;</span></code> must contain a valid token.</p></li>
<li><p>A device token is static (permanent): the device will use the same token for every request. It must be stored
somewhere safe on the device. See <a class="reference internal" href="Database-Structure.html"><span class="doc std std-doc"><code class="docutils literal notranslate"><span class="pre">TeraDevice</span></code></span></a></p></li>
<li><p>Only an enabled device (<code class="docutils literal notranslate"><span class="pre">device_enabled</span></code> in the <code class="docutils literal notranslate"><span class="pre">TeraDevice</span></code> database object) will be able to authenticate.</p></li>
</ul>
</section>
<section id="token-request-argument">
<h4>Token request argument<a class="headerlink" href="#token-request-argument" title="Link to this heading"></a></h4>
<p>Instead of using the HTTP <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> header, it is also possible to append the token to a request by using the
<code class="docutils literal notranslate"><span class="pre">token</span></code> argument.</p>
</section>
<section id="certificates">
<h4>Certificates<a class="headerlink" href="#certificates" title="Link to this heading"></a></h4>
<p>A device can also be authenticated using certificates.</p>
<ol class="arabic simple">
<li><p>The device must send a certificate signing request (standard x509 CSR) to the server using the <code class="docutils literal notranslate"><span class="pre">device/register</span></code> API.</p></li>
<li><p>The server will reply with a signed certificate.</p></li>
<li><p>The device should store this certificate in a safe place (such as in a keystore) and use the certificate in each
request made to the server.</p></li>
</ol>
</section>
</section>
<section id="service-api">
<h3>Service API<a class="headerlink" href="#service-api" title="Link to this heading"></a></h3>
<section id="id4">
<h4>Token Bearer<a class="headerlink" href="#id4" title="Link to this heading"></a></h4>
<p>Using the HTTP <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> header in a request, it is possible to use a token for authentication for services:</p>
<ul class="simple">
<li><p>In the <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> request header of the HTTP request, the <code class="docutils literal notranslate"><span class="pre">&lt;type&gt;</span></code> value must be set to <code class="docutils literal notranslate"><span class="pre">OpenTera</span></code> and the
<code class="docutils literal notranslate"><span class="pre">&lt;credentials&gt;</span></code> must contain a valid token.</p></li>
<li><p>A service token is static (permanent): the service will use the same token for every request.
See <a class="reference internal" href="Database-Structure.html"><span class="doc std std-doc"><code class="docutils literal notranslate"><span class="pre">TeraService</span></code></span></a></p></li>
<li><p>Only an enabled service (<code class="docutils literal notranslate"><span class="pre">service_enabled</span></code> in the <code class="docutils literal notranslate"><span class="pre">TeraService</span></code> database object) will be able to authenticate.</p></li>
</ul>
<p><a class="reference internal" href="Internal-services-communication-module.html"><span class="doc std std-doc">Inter communication message</span></a> is provided to access the service information
(including its token). A wrapper and base class is also available in the
<a class="reference external" href="https://pypi.org/project/opentera/">OpenTera PyPi package</a></p>
</section>
<section id="id5">
<h4>Token request argument<a class="headerlink" href="#id5" title="Link to this heading"></a></h4>
<p>Instead of using the HTTP <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> header, it is also possible to append the token to a request by using the
<code class="docutils literal notranslate"><span class="pre">token</span></code> argument.</p>
</section>
</section>
</section>
<hr class="docutils" />
<section id="login">
<h2>Login<a class="headerlink" href="#login" title="Link to this heading"></a></h2>
<p>Even if the replies can vary a little depending on the <a class="reference internal" href="../services/teraserver/api/API.html"><span class="doc std std-doc">API level</span></a> being accessed, the
login process is similar in each case. The login process is needed to get the <a class="reference internal" href="Websockets-communication.html"><span class="doc std std-doc">websocket</span></a> (if
requested), basic information about the logged on object and to get a dynamic token, if required, depending on the API
level (see above).</p>
<p>Depending on the authentication scheme and the application, the login process might be optional. Without logging in, as
long as the authentication scheme is respected, all API calls can proceed.</p>
<p><strong>Important note</strong>: A user, participant or device will not come online in regards to the
<a class="reference internal" href="../services/teraserver/UserManager-module.html"><span class="doc std std-doc">User Manager Module</span></a> unless a
<a class="reference internal" href="Websockets-communication.html"><span class="doc std std-doc">websocket connection</span></a> is established. This is by design and by the fact that the REST API,
by definition, is a stateless and asynchronous system, and thus OpenTera doesn’t have any way to know if a user,
participant or device is still there at the other end.</p>
<p>The login process can be summarized as:</p>
<ol class="arabic simple">
<li><p>Make a request with the correct authentication scheme to the <code class="docutils literal notranslate"><span class="pre">login</span></code> <a class="reference internal" href="../services/teraserver/api/API.html"><span class="doc std std-doc">API</span></a></p></li>
<li><p>If the object type is enabled (see <a class="reference internal" href="Database-Structure.html"><span class="doc std std-doc">database objects</span></a>) and if the login credentials are valid, a
return value containing at least the <code class="docutils literal notranslate"><span class="pre">_name</span></code>, the <code class="docutils literal notranslate"><span class="pre">_uuid</span></code> and the <code class="docutils literal notranslate"><span class="pre">websocket_url</span></code> will be returned. See the
<a class="reference internal" href="../services/teraserver/api/API.html"><span class="doc std std-doc">REST API</span></a> for the specific return values for each of the specific <code class="docutils literal notranslate"><span class="pre">login</span></code> functions</p></li>
<li><p>Optionally, and if the <code class="docutils literal notranslate"><span class="pre">with_websocket</span></code> parameter is set in the request, the client may connect to the
<code class="docutils literal notranslate"><span class="pre">websocket_url</span></code>. There is a 60 seconds window to establish the connection, otherwise it will be denied. That url can
only be used once: once a client is connected, it will not be available for further <a class="reference internal" href="Websockets-communication.html"><span class="doc std std-doc">websocket</span></a>
connections.</p></li>
</ol>
</section>
<section id="logout">
<h2>Logout<a class="headerlink" href="#logout" title="Link to this heading"></a></h2>
<p>While recommended, a call to the <code class="docutils literal notranslate"><span class="pre">logout</span></code> is optional.</p>
<p>When logging out, clean-up and dynamic token disabling will occur. If a websocket connection has been established, it
will close automatically.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Internal-services-communication-module.html" class="btn btn-neutral float-left" title="Inter-service communication" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../services/Services-Access.html" class="btn btn-neutral float-right" title="Services Access Roles" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Simon Brière, Dominic Létourneau.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>