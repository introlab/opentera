<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>REST API &mdash; OpenTera 1.2.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="API Documentation" href="api_doc.html" />
    <link rel="prev" title="OpenTera Service access roles" href="../OpenTera_AccessRoles.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            OpenTera
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../Home.html">Welcome to the OpenTera Wiki!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../services.html">Services</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../Service-Creation.html">Creating a new service based on OpenTera</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Services-Access.html">Services Access</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../OpenTera_Services.html">OpenTera Services Structure</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../teraserver.html">TeraServer</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../OpenTera_AccessRoles.html">OpenTera Service access roles</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">REST API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#general-structure">General structure</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#on-a-need-to-know-basis">On a need-to-know basis</a></li>
<li class="toctree-l5"><a class="reference internal" href="#api-levels">API levels</a></li>
<li class="toctree-l5"><a class="reference internal" href="#documentation">Documentation</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#request-basics">Request basics</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#get">GET</a></li>
<li class="toctree-l5"><a class="reference internal" href="#post">POST</a></li>
<li class="toctree-l5"><a class="reference internal" href="#delete">DELETE</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#further-explanation-on-some-of-the-api-functions">Further explanation on some of the API functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api_doc.html">API Documentation</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">OpenTera</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../services.html">Services</a></li>
          <li class="breadcrumb-item"><a href="../teraserver.html">TeraServer</a></li>
      <li class="breadcrumb-item active">REST API</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/services/teraserver/api/API.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="rest-api">
<h1>REST API<a class="headerlink" href="#rest-api" title="Permalink to this heading"></a></h1>
<p>OpenTera REST API is served by a <a class="reference external" href="https://flask.palletsprojects.com">Flask</a> web server.</p>
<section id="general-structure">
<h2>General structure<a class="headerlink" href="#general-structure" title="Permalink to this heading"></a></h2>
<p>OpenTera REST API main purpose is to interact with the <a class="reference internal" href="#Database-Structure"><span class="xref myst">database objects</span></a>, to control the server itself, query information and to do various actions related to the modules and system services.</p>
<p>Since OpenTera is based on a micro-service architecture, each service can expose (or not) their own REST API. Only the OpenTera API is described here, as various services might implement other scheme and features.</p>
<section id="on-a-need-to-know-basis">
<h3>On a need-to-know basis<a class="headerlink" href="#on-a-need-to-know-basis" title="Permalink to this heading"></a></h3>
<p>Every return value coming from the API will be filtered and checked against the requester <a class="reference internal" href="#Access-levels-for-user-types"><span class="xref myst">access level</span></a>. For example, a user querying for projects will only have projects that it can access, other projects being filtered out at the server level. This ensure that data cannot leak by making a general query.</p>
<p>Data API is also structured on a need-to-know basis, meaning that the requester has to make individual queries (or add the appropriate parameters to each query) to have the information it needs. There is no complete data dump API that would return everything needed by a client with a single query (which would also be very client specific, as no client implementation requires the exact same information).</p>
</section>
<section id="api-levels">
<h3>API levels<a class="headerlink" href="#api-levels" title="Permalink to this heading"></a></h3>
<p>There is 4 API levels in OpenTera: user API, participant API, device API and service API. A separation of those API was done in order to better control what each of these base user types can access.</p>
<p>Each API request can require <a class="reference internal" href="#Login-and-authentication"><span class="xref myst">authentication</span></a>, or can be fully opened, depending on the specific calls.</p>
<ul class="simple">
<li><p><strong><a class="reference external" href="https://github.com/introlab/opentera/tree/main/teraserver/python/modules/FlaskModule/API/user"><code class="docutils literal notranslate"><span class="pre">User</span> <span class="pre">API</span></code></a></strong> controls all that the users can do with OpenTera. Since most of the operations are initiated by users, this is the largest API, as every <a class="reference internal" href="#Database-Structure"><span class="xref myst">database objects</span></a> is somehow accessible using this API.</p></li>
<li><p><strong><a class="reference external" href="https://github.com/introlab/opentera/tree/main/teraserver/python/modules/FlaskModule/API/participant"><code class="docutils literal notranslate"><span class="pre">Participant</span> <span class="pre">API</span></code></a></strong> controls all that the participants can do to interact with OpenTera. For security reasons, the features available here are limited and only the required ones are exposed.</p></li>
<li><p><strong><a class="reference external" href="https://github.com/introlab/opentera/tree/main/teraserver/python/modules/FlaskModule/API/device"><code class="docutils literal notranslate"><span class="pre">Device</span> <span class="pre">API</span></code></a></strong> controls all that the devices can do to interact with OpenTera. Similarly to the participant API, the features available here are limited, and such is the returned information.</p></li>
<li><p><strong><a class="reference external" href="https://github.com/introlab/opentera/tree/main/teraserver/python/modules/FlaskModule/API/service"><code class="docutils literal notranslate"><span class="pre">Service</span> <span class="pre">API</span></code></a></strong> is a API that is only accessible by services. As such, return values are less limited than using one of the other API, though only features useful to services are implemented in that API.</p></li>
</ul>
</section>
<section id="documentation">
<h3>Documentation<a class="headerlink" href="#documentation" title="Permalink to this heading"></a></h3>
<p>Since code changes with time and that static documentation (such as this one) usually struggles to follow-up, an approach based on <a class="reference external" href="https://flask-restx.readthedocs.io/en/latest/">Flask-RESTX</a> and <a class="reference external" href="https://swagger.io/">Swagger</a> was implemented.</p>
<p>As such, each API functions are automatically documented on the server’s documentation page located at <code class="docutils literal notranslate"><span class="pre">/doc</span></code>. On a local server (such as the default configuration used for development), the documentation can then be accessed at the full url <code class="docutils literal notranslate"><span class="pre">https://127.0.0.1:40075/doc</span></code>.</p>
<p>The documentation system is interactive and can be used to test queries. As of now, only HTTP basic authentication is supported in the system.</p>
</section>
</section>
<section id="request-basics">
<h2>Request basics<a class="headerlink" href="#request-basics" title="Permalink to this heading"></a></h2>
<p>Requests to the server can easily be initiated using the correct endpoint. The base endpoint for the API is <code class="docutils literal notranslate"><span class="pre">/api</span></code>, followed by the API level required. For example, the <code class="docutils literal notranslate"><span class="pre">user</span></code> API can be accessed using the <code class="docutils literal notranslate"><span class="pre">/api/user</span></code> endpoint.</p>
<p>To access a specific function, the function name must be appended to the endpoint, followed by the parameters. For example, an user querying projects would use the <code class="docutils literal notranslate"><span class="pre">/api/user/projects</span></code> function.</p>
<section id="get">
<h3>GET<a class="headerlink" href="#get" title="Permalink to this heading"></a></h3>
<p>GET request are probably the most varied in term of parameters. See the documentation of each of those functions for a full list of the parameters.</p>
<p>All return values of the GET API are JSON-formatted string, and may include lists, dictionaries and any combination of those.</p>
<p>Some common parameters are standardized and used between all the GET API:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id_*</span></code> referring to a specific id. The end part of the id is the name of that <a class="reference internal" href="#Database-Structure"><span class="xref myst">database object</span></a>. For example, <code class="docutils literal notranslate"><span class="pre">id_site</span></code> would refer to a specific site.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">list</span></code> indicating that the return value should only contains minimal information. What is minimal information depends on each function and objects, but usually, the minimal information is only what is needed to display the returned information in a list.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">with_*</span></code> indicating that further information will be returned in the reply. When querying <a class="reference internal" href="#Database-Structure"><span class="xref myst">database objects</span></a>, this usually corresponds to <code class="docutils literal notranslate"><span class="pre">joins</span></code> between the various objects.</p></li>
</ul>
</section>
<section id="post">
<h3>POST<a class="headerlink" href="#post" title="Permalink to this heading"></a></h3>
<p>When posting data to update or create new information, some structural convention must be respected:</p>
<ul class="simple">
<li><p>Posted data should be in JSON format and in the <code class="docutils literal notranslate"><span class="pre">json</span></code> part of the request</p></li>
<li><p>A list of dictionary is needed (even if posting a single value) for the POST functions to properly works. The dictionary should have a key corresponding to the <a class="reference internal" href="#Database-Structure"><span class="xref myst">database object name</span></a> needing update, followed by a dictionary of values to update. For example, if a project should be created, the following JSON could be used:</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">['project':</span> <span class="pre">{</span> <span class="pre">id_project:</span> <span class="pre">0,</span> <span class="pre">id_site:</span> <span class="pre">1,</span> <span class="pre">project_name:</span> <span class="pre">'Doc</span> <span class="pre">Project'}]</span></code></p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">id_*</span></code> value needs to be set to <code class="docutils literal notranslate"><span class="pre">0</span></code> if creating a new data. Otherwise, it will need to be put to the correct value of the object being updated</p></li>
<li><p>Names of the keys in the object dictionary, if that object is a <a class="reference internal" href="#Database-Structure"><span class="xref myst">database object</span></a>, should be properties of the model. Thus, it is easy to find what values can be posted by looking at the definition of each objects (or the documentation of the specific API).</p></li>
</ul>
</section>
<section id="delete">
<h3>DELETE<a class="headerlink" href="#delete" title="Permalink to this heading"></a></h3>
<p>Delete queries are standardized, taking only an <code class="docutils literal notranslate"><span class="pre">id</span></code> parameter, corresponding to the id of the object to delete. There is no need to specify the specific id name related to the object needed to be deleted.</p>
</section>
</section>
<section id="further-explanation-on-some-of-the-api-functions">
<h2>Further explanation on some of the API functions<a class="headerlink" href="#further-explanation-on-some-of-the-api-functions" title="Permalink to this heading"></a></h2>
<p>Some API functions have a specific purpose that goes beyond the scope of the standard definition, and are described below.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/api/device/register</span></code> allows a device to register itself into OpenTera. The device can request a certificate from the server if the content-type of the request is set to <code class="docutils literal notranslate"><span class="pre">application/octet-stream</span></code>. Otherwise, a device token will be generated and returned to the device. In any case, the device won’t be able to log in and access the device API before a user enables the device and assign it to at least one project. This function is also rate limited (currently to 10 requests per minute) to prevent mass creation of devices.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*/refresh_token</span></code> allows to get a dynamic token using a previous dynamic token, if such <a class="reference internal" href="#Login-and-authentication"><span class="xref myst">authentication scheme</span></a> is used and available for that API.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*/login</span></code> and <code class="docutils literal notranslate"><span class="pre">*/logout</span></code> allow the login and logout process to occurs. See <a class="reference internal" href="#Login-and-authentication"><span class="xref myst">login and authentication</span></a> for more information.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/api/user/forms</span></code> allows to query a <a class="reference internal" href="#Form-Structure"><span class="xref myst">form structure</span></a> corresponding to the specified object type.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../OpenTera_AccessRoles.html" class="btn btn-neutral float-left" title="OpenTera Service access roles" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="api_doc.html" class="btn btn-neutral float-right" title="API Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Simon Brière, Dominic Létourneau.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>